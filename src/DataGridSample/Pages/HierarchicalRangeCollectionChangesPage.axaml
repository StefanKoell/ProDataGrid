<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:viewModels="clr-namespace:DataGridSample.ViewModels"
             xmlns:models="clr-namespace:DataGridSample.Models"
             xmlns:hier="clr-namespace:Avalonia.Controls.DataGridHierarchical;assembly=Avalonia.Controls.DataGrid"
             x:Class="DataGridSample.Pages.HierarchicalRangeCollectionChangesPage"
             x:DataType="viewModels:HierarchicalRangeCollectionChangesViewModel">
  <UserControl.DataContext>
    <viewModels:HierarchicalRangeCollectionChangesViewModel />
  </UserControl.DataContext>

  <Grid RowDefinitions="Auto,Auto,*"
        ColumnDefinitions="2*,*"
        Margin="12"
        ColumnSpacing="12"
        RowSpacing="8">
    <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Spacing="4">
      <TextBlock Classes="h2">Hierarchical range collection changes</TextBlock>
      <TextBlock Text="Exercise AddRange/InsertRange/RemoveRange for root and child collections with a hierarchical DataGrid."
                 TextWrapping="Wrap" />
    </StackPanel>

    <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Spacing="6">
      <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
        <TextBlock Text="Root range" VerticalAlignment="Center" />
        <Button Content="Add Root Range" Command="{Binding AddRootRangeCommand}" />
        <Button Content="Insert Root Range" Command="{Binding InsertRootRangeCommand}" />
        <Button Content="Remove Root Range" Command="{Binding RemoveRootRangeCommand}" />
        <Button Content="Reset" Command="{Binding ResetCommand}" />
        <TextBlock Text="Batch" VerticalAlignment="Center" />
        <TextBox Width="56" Text="{Binding BatchSize, UpdateSourceTrigger=PropertyChanged}" />
        <TextBlock Text="Children/Root" VerticalAlignment="Center" />
        <TextBox Width="56" Text="{Binding ChildrenPerRoot, UpdateSourceTrigger=PropertyChanged}" />
        <TextBlock Text="Insert at" VerticalAlignment="Center" />
        <TextBox Width="64" Text="{Binding RootInsertIndex, UpdateSourceTrigger=PropertyChanged}" />
        <TextBlock Text="Remove at" VerticalAlignment="Center" />
        <TextBox Width="64" Text="{Binding RootRemoveIndex, UpdateSourceTrigger=PropertyChanged}" />
      </StackPanel>

      <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
        <TextBlock Text="Child range" VerticalAlignment="Center" />
        <Button Content="Add Child Range" Command="{Binding AddChildRangeCommand}" />
        <Button Content="Insert Child Range" Command="{Binding InsertChildRangeCommand}" />
        <Button Content="Remove Child Range" Command="{Binding RemoveChildRangeCommand}" />
        <TextBlock Text="Insert at" VerticalAlignment="Center" />
        <TextBox Width="64" Text="{Binding ChildInsertIndex, UpdateSourceTrigger=PropertyChanged}" />
        <TextBlock Text="Remove at" VerticalAlignment="Center" />
        <TextBox Width="64" Text="{Binding ChildRemoveIndex, UpdateSourceTrigger=PropertyChanged}" />
      </StackPanel>
    </StackPanel>

    <DataGrid Grid.Row="2" Grid.Column="0"
              AutoGenerateColumns="False"
              HierarchicalModel="{Binding Model}"
              HierarchicalRowsEnabled="True"
              Classes="hierarchical"
              UseLogicalScrollable="True"
              RowHeight="24"
              RowHeightEstimator="{x:Null}"
              SelectionMode="Single"
              SelectionUnit="FullRow"
              SelectedItem="{Binding SelectedNode, Mode=TwoWay}"
              CanUserReorderColumns="False"
              CanUserResizeColumns="True"
              HeadersVisibility="Column"
              GridLinesVisibility="None"
              IsReadOnly="True"
              x:DataType="viewModels:HierarchicalRangeCollectionChangesViewModel">
      <DataGrid.Columns>
        <DataGridHierarchicalColumn Header="Name"
                                    Width="2*"
                                    x:CompileBindings="False"
                                    Binding="{Binding Item}">
          <DataGridHierarchicalColumn.CellTemplate>
            <DataTemplate x:DataType="models:HierarchicalStreamingItem">
              <TextBlock Text="{Binding Name}" />
            </DataTemplate>
          </DataGridHierarchicalColumn.CellTemplate>
        </DataGridHierarchicalColumn>

        <DataGridTemplateColumn Header="Id"
                                Width="80"
                                x:CompileBindings="False">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate x:DataType="hier:HierarchicalNode">
              <TextBlock x:DataType="models:HierarchicalStreamingItem"
                         DataContext="{Binding Item}"
                         Text="{Binding Id}" />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>

        <DataGridTemplateColumn Header="Price"
                                Width="100"
                                x:CompileBindings="False">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate x:DataType="hier:HierarchicalNode">
              <TextBlock x:DataType="models:HierarchicalStreamingItem"
                         DataContext="{Binding Item}"
                         Text="{Binding PriceDisplay}" />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>

        <DataGridTemplateColumn Header="Updated"
                                Width="120"
                                x:CompileBindings="False">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate x:DataType="hier:HierarchicalNode">
              <TextBlock x:DataType="models:HierarchicalStreamingItem"
                         DataContext="{Binding Item}"
                         Text="{Binding UpdatedAtDisplay}" />
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
      </DataGrid.Columns>
    </DataGrid>

    <StackPanel Grid.Row="2" Grid.Column="1" Spacing="6">
      <TextBlock Text="{Binding RootCount, StringFormat='Roots: {0}'}" />
      <TextBlock Text="{Binding VisibleCount, StringFormat='Visible nodes: {0}'}" />
      <TextBlock Text="{Binding SelectedLabel}" />
      <TextBlock Classes="h3" Text="CollectionChanged log" />
      <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
              BorderThickness="1" CornerRadius="4" Padding="4">
        <ListBox ItemsSource="{Binding Events}" />
      </Border>
    </StackPanel>
  </Grid>
</UserControl>
